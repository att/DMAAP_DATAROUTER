--
--  This SQL script creates the LOG_RECORDS table which was added in Release 1.1.0 to
--  handle all log records (replacing PUBLISH_RECORDS, DELIVERY_RECORDS, and EXPIRY_RECORDS).
--  It is run automatically by the Prov Server if the table does not exist.
--
-- $Id: mysql_init_0002,v 1.3 2013/08/05 18:09:38 eby Exp $
--

CREATE TABLE LOG_RECORDS (
    TYPE	   ENUM('pub', 'del', 'exp') NOT NULL,
    EVENT_TIME     BIGINT NOT NULL,           /* time of the publish request */
    PUBLISH_ID     VARCHAR(64) NOT NULL,      /* unique ID assigned to this publish attempt */
    FEEDID         INT UNSIGNED NOT NULL,     /* pointer to feed in FEEDS */
    REQURI         VARCHAR(256) NOT NULL,     /* request URI */
    METHOD         ENUM('DELETE', 'GET', 'HEAD', 'OPTIONS', 'PUT', 'POST', 'TRACE') NOT NULL, /* HTTP method */
    CONTENT_TYPE   VARCHAR(256) NOT NULL,     /* content type of published file */
    CONTENT_LENGTH BIGINT UNSIGNED NOT NULL,  /* content length of published file */

    FEED_FILEID    VARCHAR(128),		/* file ID of published file */
    REMOTE_ADDR    VARCHAR(40),			/* IP address of publishing endpoint */
    USER           VARCHAR(20),			/* user name of publishing endpoint */
    STATUS         SMALLINT,			/* status code returned to delivering agent */

    DELIVERY_SUBID INT UNSIGNED,		/* pointer to subscription in SUBSCRIPTIONS */
    DELIVERY_FILEID  VARCHAR(128),		/* file ID of file being delivered */
    RESULT         SMALLINT,			/* result received from subscribing agent */

    ATTEMPTS       INT,				/* deliveries attempted */
    REASON         ENUM('notRetryable', 'retriesExhausted'),

    RECORD_ID      BIGINT UNSIGNED NOT NULL PRIMARY KEY, /* unique ID for this record */

    INDEX (FEEDID) USING BTREE,
    INDEX (DELIVERY_SUBID) USING BTREE,
    INDEX (RECORD_ID) USING BTREE
) ENGINE = MyISAM;
